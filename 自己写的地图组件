<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <meta name="keywords" content="百度地图,百度地图API，百度地图自定义工具，百度地图所见即所得工具" />
    <meta name="description" content="百度地图API自定义地图，帮助用户在可视化操作下生成百度地图" />
    <title>百度地图API自定义地图</title>
    <!--引用百度地图API-->
    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=2.0&ak=6b6c1a67eaa7db1ca6d6da28e590e343&services=true"></script>
    <script src="https://cdn.staticfile.org/jquery/1.11.1/jquery.min.js"></script>
</head>

<body>
    <!--百度地图容器-->
    <div style="width:697px;height:550px;border:#ccc solid 1px;" id="allmap"></div>
    <!-- 搜索框 -->
    <div id="r-result">请输入:<input type="text" id="suggestId" size="20" value="百度" style="width:150px;" /></div>
    <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
</body>
<script>
    var myValue;
    // 百度地图API功能
    var map = new BMap.Map("allmap"); // 创建Map实例
    var point = new BMap.Point(116.404, 39.915)
    map.centerAndZoom(point, 18); // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
    // 添加标注
    addMarker(point);
    // 拖动事件
    map.addEventListener("dragend", function() {
        var center = map.getCenter();
        addMarker(new BMap.Point(center.lng, center.lat))
    });
    // 添加搜索事件
    initSearch();

    // ---------------------------搜搜地址相关----------------------------
    function initSearch() {
        var ac = new BMap.Autocomplete( //建立一个自动完成的对象
            {
                "input": "suggestId",
                "location": map
            });

        ac.addEventListener("onconfirm", function(e) { //鼠标点击下拉列表后的事件
            var _value = e.item.value;
            myValue = _value.province + _value.city + _value.district + _value.street + _value.business;
            $("#searchResultPanel").innerHTML = "onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

            setPlace();
        });

        function setPlace() {
            var local = new BMap.LocalSearch(map, { //智能搜索
                onSearchComplete: myFun
            });
            local.search(myValue);

            function myFun(result) {
                console.log("搜索到的结果：" + JSON.stringify(result));
                if (result.Ar.length !== 0) {
                    map.panTo(result.Ar[0].point); //将地图平移到中心点
                    addMarker(new BMap.Point(result.Ar[0].point.lng, result.Ar[0].point.lat))
                }

            }
        }
    }
    // ---------------------------标注相关--------------------------------
    //    添加标注
    function addMarker(point) {
        // 在添加新标注之前删除原先的标注
        deletePoint()
            // 添加标注
        var marker = new BMap.Marker(point); // 创建标注 
        console.log("标注信息：" + JSON.stringify(marker));

        map.addOverlay(marker);
        marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
        marker.enableDragging() //设置标注可以拖动  
        marker.addEventListener("dragend", function(e) {
            map.panTo(e.point); //将地图平移到中心点
            console.log(e);
        });
        //删除标注
        function deletePoint() {
            var allOverlay = map.getOverlays();
            for (let i = 0; i < allOverlay.length; i++) {
                map.removeOverlay(allOverlay[i]);
            }
        }

    }
</script>

</html>
